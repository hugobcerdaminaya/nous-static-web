<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Sitio | P치gina edici칩n</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css">
</head>
<body class="container">
  <h1>Formulario para editar la p치gina</h1>
  <a href="/sitio/contenido" class="btn btn-sm btn-primary"> << Regresar a tabla de contenidos del sitio</a>
  <input id="data" type="hidden" value="<%= formulario %>" />
  <input id="data_values" type="hidden" value="<%= formulario_values %>" />
  <form action="/save-values-sitio" method="POST"></form>
  <div id="res" class="alert"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.4/underscore-umd-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonform/2.2.5/jsonform.js"></script>
  <script>
   let data = JSON.parse(document.getElementById("data").value);
   let data_values = JSON.parse(document.getElementById("data_values").value);
   $('form').jsonForm({
        schema: {
          data
        },
        value:
          data_values
        ,
        "form": [
            "*",
            {
            "type": "submit",
            "title": "Enviar formulario"
            }    
        ],
        onSubmit: function (errors, values) {
          if (errors) {
            $('#res').html('<p>Ha ocurrido un error al momento de intentar enviar el formulario</p>');
          }else{
            $.ajax({
              type: "POST",
              url: '/save-values',
              data: {values: values},
              success: function(result){
                $('#res').html('<p>La p치gina ' + values.data.pagina.titulo + ' con fecha <br/>' +
                values.data.pagina.fecha + ', ha sido actualizada. </p>');     
              }
            });
          }
        }
      });
  </script>
</body>
</html>